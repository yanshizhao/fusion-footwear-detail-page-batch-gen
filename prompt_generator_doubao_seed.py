import time
import json


def get_product_detail_prompts(client, image_urls, userStr, screenNum):
    """
    生成符合SHEIN/TikTok风格的详情页，每屏内容单独成段输出
    """
    prompt_template = """角色定位：跨境电商鞋类视觉设计师 + Gemini 3 Pro Image 提示词工程师，专注欧美 18-45 岁女性鞋类，核心任务是提取参考图特征并融合 {userStr}（风格 / 场景等需求），按 SHEIN/TikTok/Amazon A + 规范生成 {total_screens} 屏详情页设计及英文提示词，核心要求为贴合产品、满足需求、突出鞋款。核心：双信息源融合规则，图片特征提取为基础不可篡改，需提取核心属性（鞋型、材质、配色、鞋跟 / 鞋头 / 鞋帮、工艺 / 装饰）、视觉特征（版型风格、材质质感 / 哑光 / 亮面等、功能设计 / 透气孔等）、拍摄特征（实际拍摄视角 / 左 45°/ 右 45° 等、拍摄姿态 / 静态 / 动态）；{userStr} 需求拆解为定制补充，拆解卖点 / 风格 / 场景 / 运营要求等需求，融合规则为①图有 + 用户强调→强化 ②图无 + 用户要求→合理补充 ③冲突→以图为准 ④无需求→纯按图设计；融合输出要求为所有设计 = 图片特征 + 用户需求，保证真实、定制、无冗余、无偏离。全局核心设计规则为落地关键，背景适配为核心，适配规则是按鞋款颜色 + 类型匹配底色，场景屏可加轻场景元素不喧宾夺主，颜色适配为浅色系鞋→浅灰 #F5F5F5 / 淡驼 #F5F0E6 / 浅燕麦 #F7F3E9、深色系鞋→米白 #FFFFFF / 奶油白 #FFFDE7 / 浅卡其 #F9F6F0、亮色→浅灰 #EEEEEE / 米灰 #F2F2F2、多色→主色邻近浅色系 / 红黑拼接→浅红棕 #F8E0E0，所有背景色需明确标注色值确保色彩精准还原，类型适配为休闲 / 运动→浅灰帆布肌理 #F5F5F5、优雅 / 高跟→米白哑光 #FFFFFF matte、复古→暖调浅底 / 浅棕 #F5EEE6 / 浅咖 #F2E8D5、沙滩 / 凉鞋→浅蓝 #F0F8FF / 浅米色 #FFF9E6，肌理背景需在色值基础上叠加质感描述，场景补充为特定场景→基础底色 + 轻元素 / 沙滩→浅米色 #FFF9E6 + 沙粒肌理且不喧宾夺主，色彩精准要求为背景色需严格匹配标注色值 / 深色系鞋用米白 #FFFFFF / 奶油白 #FFFDE7 避免浅灰，生成前核对适配性确保底色纯净无杂色、哑光质感、无反光。字体规范按鞋型 + 平台 + 需求，字体类型为优雅款→Montserrat Light/Playfair Display Light、复古款→Playfair Display Medium/Lato Bold、休闲款→Arial Bold/Roboto Black、简约款→Roboto Medium/Open Sans SemiBold，可按风格微调字体；字体颜色基础规则为浅鞋浅底→深炭灰 / 巧克力棕、深鞋浅底→米白 / 奶油白、中性色→深灰 / 焦糖棕、亮色→深炭灰 / 对比清晰，SHEIN/TikTok 可加辅助色，Amazon A + 用低饱和色；字体大小按平台规范，SHEIN/TikTok/ 移动端→标题 28pt / 副标题 20pt / 文案 16pt，Amazon A+→标题 24pt / 副标题 18pt / 文案 14pt，细节标签 12-14pt，直播 / 高端质感场景可调整字号 / 字间距；排版规则为必守，文字不遮挡产品，标题字间距 1-2px、副标题 / 文案 0.5px、行间距 1.2 倍，全屏字体 / 配色统一且按大小分层。视觉 & 模特核心要求为光影用柔和影棚软光并按哑光 / 亮面调整强度，审美贴合欧美 36-40 码女性偏好，布局贴合平台排版习惯，生活化构图为元素融入场景 / 占比≤10% 且无贴纸感 / 休闲鞋→木地板 + 帆布包轮廓；模特规则为所有鞋型统一要求，均贴合欧美穿搭习惯，需结合鞋型、季节、风格智能判断搭配，模特仅展示脸部以下下半身区域且不露脸，拍摄焦点全程锁定在鞋子上且搭配元素不喧宾夺主，凉鞋优先无袜子仅做简约脚踝点缀 / 细脚链 / 美甲，若为秋冬款凉鞋或复古风格需求可搭配超薄短袜且需贴合整体风格，其余鞋型按季节与风格适配搭配 / 低帮单鞋春夏可无袜、秋冬配简约短袜，中高帮鞋可搭配同色系袜子 / 小腿链且姿态自然；风格配图要求为 {total_screens} > 5 时生效，需覆盖通勤 / 休闲 / 约会等不同场景，贴合鞋款调性与 {userStr} 需求，通过场景元素、模特搭配区分风格，保证视觉一致且与不同拍摄角度绑定；卖点标注箭头规范为用贴合鞋款风格的艺术化箭头，兼顾美观与吸引力，简约款→纤细流线型 / 带微弧，尾部渐变收窄，复古款→微粗圆角 / 边缘圆润，可加细纹理，优雅款→曲线缠绕 / 花瓣轮廓 / 线条柔和，休闲款→几何拼接 / 简约有设计感，颜色选低饱和莫兰迪色 / 深灰 #333333 / 浅棕 #8B7355 等且禁纯黑，线条粗细 1.0-1.5px 且与文字衔接自然。文案规则为标题 = 鞋型 + 特征 + 需求重点，副标题 = 卖点 + 场景，优先标注图中可见特征且不虚标，模特屏文案不遮挡鞋款 / 模特且突出上脚卖点。必选核心屏要求为 {total_screens} 屏必含，首屏 / 引流为主视觉是静物图，视角以参考图为准 / 无参考图默认左 45°，背景适配且可加轻场景元素 / 无模特，设计为标题突出特征 + 需求重点且字体 / 颜色匹配平台，重点是第一眼突出产品 + 核心需求并优先引流；卖点标注屏主视觉是图片 + 3-5 个不重复的卖点标注，视角以参考图为准 / 无参考图默认左 45°，标注用贴合风格、美观有吸引力且不死板的艺术化箭头 + 文字组合，可加极简场景元素；细节四宫格屏主视觉是 4 张细节特写，背景适配且无单独装饰，标签为细节 + 需求价值且用小字体，重点是突出质感；模特上脚屏主视觉是模特下半身，按模特规则搭配并结合鞋型 / 季节 / 风格智能适配穿搭，突出鞋子贴合度 / 显腿效果且拍摄焦点全程聚焦在鞋子上，文案突出上脚体验 + 风格，重点是提升代入感，补充要求为 {total_screens} > 5 时需增设至少 1 个不同角度的模特屏 / 正面→侧方 / 斜后方 / 45° 上脚等，共至少 2 个不同角度，模特屏需融入对应风格场景，展现上脚质感与多元场景适配性。分屏逻辑 & 动态适配为核心信息无缺失，基础核心屏 / 7 屏为首屏→卖点标注→细节四宫格→模特上脚→场景搭配→多色 / 有则加→多角度；实用转化屏 / 8-12 屏为 8. 多角度细节→9. 场景拓展→10. 尺码说明 / 可视化 + 适配建议→11. 对比优势 / 分栏→12. 总结推荐 / 卖点汇总 + 购买引导；超 12 屏延伸 / 按序为 13. 多色 / 无则跳→14. 用户实测→15. 工艺解析→16. 包装展示→17. 售后保障；需求适配为①特定场景 / 模特上脚 / 多色强调→对应屏优先 / 增加，后续顺延 ②{total_screens} > 5 时需分配 2-3 种风格配图，不同风格搭配不同拍摄角度 / 含至少 2 个不同角度模特屏，可选正面 / 侧方行走 / 斜后方 / 45° 上脚 / 踮脚试穿等，风格与角度差异化均匀分布且不堆砌；每屏聚焦 1-2 个融合卖点，不信息过载，全流程背景 / 字体 / 元素风格统一。Gemini 提示词核心要求为直接生图，固定结构为 e-commerce product photography + 双源特征（图 + 需求 + 鞋帮 + 拍摄视角） + 视角（参考图为准，无则左 45°；模特屏标注具体角度，多模特屏标注不同角度） + 智能背景（含精准色值 + 哑光 / 肌理） + 生活化构图（标功能目标） + 卖点标注细节（艺术化箭头样式 / 风格 / 颜色 / 粗细，非标注屏可省） + 模特规则（非模特屏可省；多模特屏区分角度 + 融入风格场景，结合鞋型 / 季节 / 风格智能适配穿搭） + 文案 + 字体全信息 + 固定参数 + 负面清单，生成需基于双信息源融合规则，优先匹配图片特征与用户需求；双源标注为明确标注图特征、需求、背景、构图、功能目标、模特规则 / 低帮鞋标注英文要求；固定参数为 ultra-detailed product texture, sharp focus on shoes, high color accuracy (including background color matching the specified hex code), consistent font/background style, soft studio light enhances shoe texture；负面清单为 no fake shoe texture/luster, no product distortion, inconsistent font/background style, deviate from product features, separate sticker-like elements, text blocking product, rigid pure black arrows, plain and unattractive arrows, background color deviation from specified hex code。输出格式为必守，按屏序 1-{total_screens} 输出，每屏 1 条英文提示词且单独成行，无额外文字，纯英文无中文且信息无漏项，每条含全量设计信息可直接生图，仅屏序 + 提示词，无标题 / 空行 / 错误。注：所有规则优先遵循双信息源融合规则，冲突时以图片特征 + 用户需求为准。"""
    # 格式化提示词
    prompt = prompt_template.format(
        total_screens=screenNum,
        userStr=userStr
    )

    # 构造请求：图片 + 文本提示
    content = []
    for img_url in image_urls:
        content.append({"type": "input_image", "image_url": img_url})
    content.append({"type": "input_text", "text": prompt})

    # 调用豆包视觉模型
    response = client.responses.create(
        #model="doubao-seed-1-6-vision-250815",
        model="doubao-seed-1-8-251228",
        input=[{"role": "user", "content": content}]
    )

    # 解析响应
    response_dict = response.model_dump()
    output_text = response_dict["output"][1]["content"][0]["text"]
    return output_text